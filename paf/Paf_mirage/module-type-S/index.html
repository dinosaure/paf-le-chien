<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>S (paf.Paf_mirage.S)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">paf</a> &#x00BB; <a href="../index.html">Paf_mirage</a> &#x00BB; S</nav><header class="odoc-preamble"><h1>Module type <code><span>Paf_mirage.S</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-stack" class="anchored"><a href="#type-stack" class="anchor"></a><code><span><span class="keyword">type</span> stack</span></code></div><div class="spec-doc"><p>The type of the TCP/IP stack.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-TCP" class="anchored"><a href="#module-TCP" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="TCP/index.html">TCP</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-TLS" class="anchored"><a href="#module-TLS" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="TLS/index.html">TLS</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The type of the <i>socket</i> bound on a specific port (via <a href="#val-init"><code>init</code></a>).</p></div></div><div class="odoc-spec"><div class="spec type" id="type-dst" class="anchored"><a href="#type-dst" class="anchor"></a><code><span><span class="keyword">type</span> dst</span><span> = <span class="xref-unresolved">Ipaddr</span>.t * int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-init" class="anchored"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>port:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-stack">stack</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>init ~port stack</code> bounds the given <code>stack</code> to a specific port and return the main socket <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-accept" class="anchored"><a href="#val-accept" class="anchor"></a><code><span><span class="keyword">val</span> accept : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="TCP/index.html#type-flow">TCP.flow</a>, <span>[&gt; `Closed ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>accept t</code> waits an incoming connection and return a <i>socket</i> connected to a peer.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-close" class="anchored"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>close t</code> closes the main <em>socket</em>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-http_service" class="anchored"><a href="#val-http_service" class="anchor"></a><code><span><span class="keyword">val</span> http_service : <span>?config:<span class="xref-unresolved">Httpaf</span>.Config.t <span class="arrow">&#45;&gt;</span></span>
<span>error_handler:<span>(<span><a href="#type-dst">dst</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Httpaf</span>.Server_connection.error_handler)</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><a href="TCP/index.html#type-flow">TCP.flow</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-dst">dst</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Httpaf</span>.Server_connection.request_handler)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../Paf/index.html#type-service">Paf.service</a></span></span></code></div><div class="spec-doc"><p><code>http_service ~error_handler request_handler</code> makes an HTTP/AF service where any HTTP/1.1 requests are handled by <code>request_handler</code>. The returned service is not yet launched (see <a href="#val-serve"><code>serve</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-https_service" class="anchored"><a href="#val-https_service" class="anchor"></a><code><span><span class="keyword">val</span> https_service : <span>tls:<span class="xref-unresolved">Tls</span>.Config.server <span class="arrow">&#45;&gt;</span></span> <span>?config:<span class="xref-unresolved">Httpaf</span>.Config.t <span class="arrow">&#45;&gt;</span></span>
<span>error_handler:<span>(<span><a href="#type-dst">dst</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Httpaf</span>.Server_connection.error_handler)</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>(<span><a href="TLS/index.html#type-flow">TLS.flow</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-dst">dst</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Httpaf</span>.Server_connection.request_handler)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../Paf/index.html#type-service">Paf.service</a></span></span></code></div><div class="spec-doc"><p><code>https_service ~tls ~error_handler request_handler</code> makes an HTTP/AF service over TLS (from the given TLS configuration). Then, HTTP/1.1 requests are handled by <code>request_handler</code>. The returned service is not yet launched (see <a href="#val-serve"><code>serve</code></a>).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-serve" class="anchored"><a href="#val-serve" class="anchor"></a><code><span><span class="keyword">val</span> serve : <span>?stop:<span class="xref-unresolved">Lwt_switch</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'t</span> <a href="../../Paf/index.html#type-service">Paf.service</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span> <span>[ <span>`Initialized of <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span> ]</span></span></code></div><div class="spec-doc"><p><code>serve ?stop service</code> returns an initialized promise of the given service <code>service</code>. <code>stop</code> can be used to stop the service.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-tcp_protocol" class="anchored"><a href="#val-tcp_protocol" class="anchor"></a><code><span><span class="keyword">val</span> tcp_protocol : <span><span>(<a href="#type-stack">stack</a> * <span class="xref-unresolved">Ipaddr</span>.t * int, <a href="TCP/index.html#type-flow">TCP.flow</a>)</span> <span class="xref-unresolved">Mimic</span>.protocol</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tcp_edn" class="anchored"><a href="#val-tcp_edn" class="anchor"></a><code><span><span class="keyword">val</span> tcp_edn : <span><span>(<a href="#type-stack">stack</a> * <span class="xref-unresolved">Ipaddr</span>.t * int)</span> <span class="xref-unresolved">Mimic</span>.value</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tls_edn" class="anchored"><a href="#val-tls_edn" class="anchor"></a><code><span><span class="keyword">val</span> tls_edn : <span><span>(<span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span> * <span class="xref-unresolved">Tls</span>.Config.client * <a href="#type-stack">stack</a> * <span class="xref-unresolved">Ipaddr</span>.t * int)</span> <span class="xref-unresolved">Mimic</span>.value</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-tls_protocol" class="anchored"><a href="#val-tls_protocol" class="anchor"></a><code><span><span class="keyword">val</span> tls_protocol : <span><span>(<span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span> * <span class="xref-unresolved">Tls</span>.Config.client * <a href="#type-stack">stack</a> * <span class="xref-unresolved">Ipaddr</span>.t * int, <a href="TLS/index.html#type-flow">TLS.flow</a>)</span> <span class="xref-unresolved">Mimic</span>.protocol</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>ctx:<span class="xref-unresolved">Mimic</span>.ctx <span class="arrow">&#45;&gt;</span></span> <span>error_handler:<span>(<span><span><a href="#type-dst">dst</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Alpn/index.html#type-client_error">Alpn.client_error</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span>response_handler:<span>(<span><span><a href="#type-dst">dst</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Alpn/index.html#type-response">Alpn.response</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Alpn/index.html#type-body">Alpn.body</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
<span><span>[ <span>`V1 of <span class="xref-unresolved">Httpaf</span>.Request.t</span> <span><span>| `V2</span> of <span class="xref-unresolved">H2</span>.Request.t</span> ]</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../../Alpn/index.html#type-body">Alpn.body</a>, <span>[&gt; <span class="xref-unresolved">Mimic</span>.error ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div></div></div></body></html>